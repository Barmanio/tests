{% extends "base.html" %}

{% block title %}{{ task.title }} ‚Äî –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ–±—É—á–µ–Ω–∏—è{% endblock %}

<!-- –û—Ç–∫–ª—é—á–∞–µ–º —Ö–µ–¥–µ—Ä —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞–¥–∞—á–∏ -->
{% block header %}{% endblock %}

<!-- –í–∫–ª—é—á–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö–µ–¥–µ—Ä –±–µ–∑ –∫–Ω–æ–ø–æ–∫ -->
{% block custom_header %}
<div style="
    background: #f4f6f8;
    padding: 16px 20px;
    border-bottom: 1px solid #e0e0e0;
    text-align: center;
    font-size: 18px;
    font-weight: 600;
    color: #1a1a1a;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
">
    {{ task.title }}
</div>
{% endblock %}

{% block content %}
<!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è ID –∑–∞–¥–∞—á–∏ ‚Äî –Ω—É–∂–Ω–æ –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
<input type="hidden" id="task-id" value="{{ task.id }}">
{% if current_user and current_user.is_admin %}
<div style="text-align: center; margin: 16px 0;">
    <a
            href="/edit-task?task_id={{ task.id }}"
            style="
 display: inline-block;
 background: #007bff;
 color: white;
 padding: 10px 20px;
 border-radius: 6px;
 text-decoration: none;
 font-size: 14px;
 font-weight: 500;
 box-shadow: 0 2px 4px rgba(0,0,0,0.1);
 transition: background 0.3s;
 "
            onmouseover="this.style.background='#0056b3'"
            onmouseout="this.style.background='#007bff'">
        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É
    </a>
    <form action="/delete-task" method="post" style="display: inline;">
        <input type="hidden" name="task_id" value="{{ task.id }}">
        <button type="submit"
                onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É? –í—Å–µ —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.');"
                style="
 background: #e74c3c;
 color: white;
 border: none;
 padding: 10px 20px;
 border-radius: 6px;
 font-weight: 500;
 cursor: pointer;
 box-shadow: 0 2px 4px rgba(0,0,0,0.1);
 ">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
        </button>
    </form>
</div>
{% endif %}
<h2 style="color: #333; font-size: 1.3em; margin-top: 20px;">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</h2>
<p style="font-size: 16px; color: #555; line-height: 1.6;">{{ task.description }}</p>
{% for example in examples %}
<div style="margin-bottom: 16px;">
    <p><strong>–ü—Ä–∏–º–µ—Ä {{ loop.index }}:</strong></p>
    <div style="display: flex; gap: 20px; font-family: monospace; font-size: 14px;">
        <div style="flex: 1; background: #f1f1f1; padding: 10px; border-radius: 6px;">
            <strong>–í–≤–æ–¥:</strong><br>
            <code>{{ example.input|replace('\n', '<br>')|safe }}</code>
        </div>
        <div style="flex: 1; background: #e8f5e8; padding: 10px; border-radius: 6px;">
            <strong>–í—ã–≤–æ–¥:</strong><br>
            <code>{{ example.output|replace('\n', '<br>')|safe }}</code>
        </div>
    </div>
</div>
{% endfor %}
{% if error %}
<div class="alert alert-error">
    <strong>‚ùå –û—à–∏–±–∫–∞:</strong> {{ error }}
</div>
{% endif %}

<form method="post" action="/check-solution" id="solution-form">
    <input type="hidden" name="task_id" value="{{ task.id }}">
    <textarea
            name="code"
            id="code-input"
            style="width: 100%; height: 200px; font-family: 'Courier New', monospace; font-size: 14px; padding: 14px; border: 1px solid #ccc; border-radius: 8px; resize: vertical; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 16px; outline: none;"
            placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ Python. –ù–∞–ø—Ä–∏–º–µ—Ä:
a, b = map(int, input().split())
print(a + b)"
    >{{ code }}</textarea>
    <button type="submit" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ</button>
</form>

<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
{% if results %}
<div class="results" style="margin-top: 30px;">
    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤: {{ passed }} –∏–∑ {{ total }} –ø—Ä–æ–π–¥–µ–Ω–æ</h2>

    {% for r in results %}
    <div class="test-case"
         style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-bottom: 12px; border-left: 5px solid {% if r.passed %}#28a745{% else %}#dc3545{% endif %};">
        <strong>–í–≤–æ–¥:</strong> <code>{{ r.input }}</code><br>
        <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> <code>{{ r.expected }}</code><br>
        <strong>–í–∞—à –≤—ã–≤–æ–¥:</strong> <code>{{ r.output }}</code>
    </div>
    {% endfor %}

    {% if status == "passed" %}
    <div class="alert alert-success">
        <strong>‚úÖ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!</strong>
    </div>
    {% else %}
    <div class="alert alert-error">
        <strong>‚ùå –ù–µ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑!</strong>
    </div>
    {% endif %}
</div>
{% endif %}

<!-- –°—Å—ã–ª–∫–∞ "–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é" –≤–Ω–∏–∑—É -->
<div style="text-align: center; margin: 30px 0;">
    <a href="/home" style="color: #2a8d9c; text-decoration: none; font-size: 0.95em;">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
</div>

<script>
    // –ö–ª—é—á –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–¥–∞: draft-task-{id}
    const taskId = document.getElementById('task-id').value;
    const storageKey = `task-draft-${taskId}`;

    // –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
    window.addEventListener('load', () => {
        const saved = localStorage.getItem(storageKey);
        const textarea = document.getElementById('code-input');

        // –ï—Å–ª–∏ –≤ localStorage –µ—Å—Ç—å –∫–æ–¥ –∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ (–∏–ª–∏ –Ω–µ –±—ã–ª–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ)
        if (saved && !textarea.value.trim()) {
            textarea.value = saved;
            console.log(`üîÅ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–Ω–æ–≤–∏–∫ –¥–ª—è –∑–∞–¥–∞—á–∏ ${taskId}`);
        }
    });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞
    document.getElementById('code-input').addEventListener('input', () => {
        const code = document.getElementById('code-input').value;
        try {
            localStorage.setItem(storageKey, code);
            console.log('üíæ –ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
        } catch (e) {
            console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫', e);
        }
    });

    // –û—á–∏—Å—Ç–∫–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ (–µ—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã)
    {% if status == "passed" %}
    try {
        localStorage.removeItem(storageKey);
        console.log('üóëÔ∏è –ß–µ—Ä–Ω–æ–≤–∏–∫ —É–¥–∞–ª—ë–Ω ‚Äî –∑–∞–¥–∞—á–∞ —Ä–µ—à–µ–Ω–∞');
    } catch (e) {
        console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ –ø–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è', e);
    }
    {% endif %}
</script>
{% endblock %}
